---
- name: Verify creation with existing VM
  connection: local
  gather_facts: false
  hosts: localhost
  tasks:
    - name: Create a VM
      kubevirt.core.kubevirt_vm:
        name: testvm
        namespace: default
        labels:
          app: test
      register: recreate
    - name: Assert module reported no changes
      ansible.builtin.assert:
        that:
          - not recreate.changed

- name: Delete VM
  connection: local
  gather_facts: false
  hosts: localhost
  tasks:
    - name: Delete a VM
      kubevirt.core.kubevirt_vm:
        name: testvm
        namespace: default
        state: absent
        wait: true

- name: Verify VM deletion
  connection: local
  gather_facts: false
  hosts: localhost
  tasks:
    - name: Delete a VM
      kubevirt.core.kubevirt_vm:
        name: testvm
        namespace: default
        state: absent
      register: delete
    - name: Assert module reported no changes
      ansible.builtin.assert:
        that:
          - not delete.changed
